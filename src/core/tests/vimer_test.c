#include "test.h"

START_TEST(parser_t1) {
  model m;
  const char path[] = "../models/prism.obj";
  parseobj(path, &m);
  const float waitingTriangles[] = {4.5973, -4.8484, -0.0000,
                                    0.0000, -4.8484, 7.9628,
                                    -4.5973, -4.8484, -0.0000,
                                    -4.5973, -4.8484, -0.0000,
                                    0.0000, -4.8484, 7.9628,
                                    -0.0000, 4.8484, 7.9628,
                                    -0.0000, 4.8484, 7.9628,
                                    -4.5973, 4.8484, -0.0000,
                                    -4.5973, -4.8484, -0.0000,
                                    0.0000, -4.8484, 7.9628,
                                    4.5973, -4.8484, -0.0000,
                                    4.5973, 4.8484, -0.0000,
                                    4.5973, 4.8484, -0.0000,
                                    -0.0000, 4.8484, 7.9628,
                                    0.0000, -4.8484, 7.9628,
                                    4.5973, -4.8484, -0.0000,
                                    -4.5973, -4.8484, -0.0000,
                                    -4.5973, 4.8484, -0.0000,
                                    -4.5973, 4.8484, -0.0000,
                                    4.5973, 4.8484, -0.0000,
                                    4.5973, -4.8484 ,-0.0000,
                                    4.5973 ,4.8484 ,-0.0000,
                                    -4.5973 ,4.8484 ,-0.0000,
                                    -0.0000, 4.8484, 7.9628};
  const float waitingLines[] = {4.5973, -4.8484, -0.0000,
                                0.0000, -4.8484, 7.9628,
                                0.0000, -4.8484, 7.9628,
                                -4.5973, -4.8484, -0.0000,
                                -4.5973, -4.8484, -0.0000,
                                4.5973, -4.8484, -0.0000,
                                -4.5973, -4.8484, -0.0000,
                                0.0000, -4.8484, 7.9628,
                                0.0000, -4.8484, 7.9628,
                                -0.0000, 4.8484, 7.9628,
                                -0.0000, 4.8484, 7.9628,
                                -4.5973, 4.8484, -0.0000,
                                -4.5973, 4.8484, -0.0000,
                                -4.5973, -4.8484, -0.0000,
                                0.0000, -4.8484, 7.9628,
                                4.5973, -4.8484, -0.0000,
                                4.5973, -4.8484, -0.0000,
                                4.5973, 4.8484, -0.0000,
                                4.5973, 4.8484, -0.0000,
                                -0.0000, 4.8484, 7.9628,
                                -0.0000, 4.8484, 7.9628,
                                0.0000, -4.8484, 7.9628,
                                4.5973, -4.8484, -0.0000,
                                -4.5973, -4.8484, -0.0000,
                                -4.5973, -4.8484, -0.0000,
                                -4.5973, 4.8484, -0.0000,
                                -4.5973, 4.8484, -0.0000,
                                4.5973, 4.8484, -0.0000,
                                4.5973, 4.8484, -0.0000,
                                4.5973, -4.8484, -0.0000,
                                4.5973, 4.8484, -0.0000,
                                -4.5973, 4.8484, -0.0000,
                                -4.5973, 4.8484, -0.0000,
                                -0.0000, 4.8484, 7.9628,
                                -0.0000, 4.8484, 7.9628,
                                4.5973, 4.8484, -0.0000};
  ck_assert_uint_eq(m.allIndex, 24);
  ck_assert_uint_eq(m.lineIndex, 36);
  for (size_t i = 0; i < m.allIndex * 3; i++) {
    ck_assert_float_eq_tol(waitingTriangles[i], m.vertexArray[i], 1e-6);
  }
  for (size_t i = 0; i < m.lineIndex * 3; i++) {
    ck_assert_float_eq_tol(waitingLines[i], m.linesArray[i], 1e-6);
  }
  free(m.vertexArray);
  free(m.linesArray);
  if(m.name) free(m.name);
}
END_TEST

Suite *VimerSuite() {
  Suite *vimer = suite_create("[Vimer Unit Test]");
  TCase *tc = tcase_create("vimer");

  tcase_add_test(tc, parser_t1);

  suite_add_tcase(vimer, tc);

  return vimer;
}
